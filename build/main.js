!function(t){function e(t,e,i,n){t.strokeStyle=i,t.lineWidth=n,t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var o=0;o<e.length;o++)t.lineTo(e[o].x,e[o].y);t.stroke(),t.closePath()}function i(t,e,i,n,o,s,c){t.fillStyle=o,t.strokeStyle=s,t.lineWidth=c,t.beginPath(),t.arc(e,i,n-c,0,2*Math.PI),t.arc(e,i,n,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()}function n(t){var e=t.currentTarget.getBoundingClientRect();return{x:t.touches[0].clientX-e.left,y:t.touches[0].clientY-e.top}}function o(t,e,i){return Math.abs(t.x-e.x)<=i&&Math.abs(t.y-e.y)<=i}function s(t,e){return t.some(function(t){return t.index===e.index})}function c(t,e){if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(t[i].index!==e[i].index)return!1;return!0}function d(e,i){t.localStorage.setItem(e,JSON.stringify(i))}function r(e){var i,n=t.localStorage.getItem(e);try{i=JSON.parse(n)}catch(t){return console.error(t),!1}return i}function a(t){l.innerHTML=t}function h(t){t.checked=!0}var l=document.getElementById("lockInfo"),u=document.getElementById("setPasswd"),f=document.getElementById("checkPasswd");t.Lock=function(t){this.canvas=document.getElementById("lock"),this.radius=this.canvas.width/14,this.context=this.canvas.getContext("2d"),this.nodeList=[],this.activeNodeList=[],this.passwdList=[],this.touching=!1,t=t||{},this.options={nodeFillStyle:t.nodeFillStyle||"#fff",nodeBorderStyle:t.nodeBorderStyle||"#bcbcbc",nodeBorderWidth:t.nodeBorderWidth||2,activeNodeFillStyle:t.activeNodeFillStyle||"#FFA726",activeNodeBorderStyle:t.activeNodeBorderStyle||"#E36265",lineStyle:t.lineStyle||"#f00",lineWidth:t.lineWidth||2},this.initNodes(),this.bindEvent(),this.initStatus()};var v=Lock.prototype;v.bindEvent=function(){var t=this.options,e=this.canvas,s=this;e.addEventListener("touchstart",function(e){for(var c=s.radius,d=s.nodeList,r=n(e),a=0;a<d.length;a++)o(r,d[a],c)&&(i(s.context,d[a].x,d[a].y,c,t.activeNodeFillStyle,t.activeNodeBorderStyle,t.nodeBorderWidth),s.activeNodeList.push(d[a]),s.touching=!0)}),e.addEventListener("touchmove",function(t){s.touching&&s.update(n(t))}),e.addEventListener("touchend",function(t){if(s.touching){s.touching=!1;var e=s.activeNodeList,i=s.passwdList;switch(i.length){case 0:e.length<5?a("密码太短，至少需要 5 个点"):(i.push(e),a("请再次输入手势密码"));break;case 1:c(i[0],e)?(d("uniquePasswd",e),s.switchStatusToCheck(e),a("密码设置成功")):(s.switchStatusToSet(),a("两次输入的不一致，重新设置"));break;case 2:var n=r("uniquePasswd");if(!n){s.switchStatusToSet(),a("储存的密码破损，请重新设置");break}a(c(n,e)?"密码正确":"输入的密码不正确");break;default:u.click()}console.log(e.map(function(t){return t.index})),s.resetNodes()}}),document.body.addEventListener("touchmove",function(t){t.preventDefault()}),u.addEventListener("click",function(t){s.switchStatusToSet(),a("请输入手势密码")}),f.addEventListener("click",function(t){var e=r("uniquePasswd");e?(s.switchStatusToCheck(e),a("请输入手势密码解锁")):u.click()})},v.initNodes=function(){this.nodeList=[];for(var t=this.options,e=this.canvas,n=this.radius,o=this.context,s=this.nodeList,c=0;c<3;c++)for(var d=0;d<3;d++){var r={x:3*n+4*n*d,y:3*n+4*n*c,index:3*c+d+1};s.push(r)}for(o.clearRect(0,0,e.width,e.height),c=0;c<s.length;c++)i(o,s[c].x,s[c].y,n,t.nodeFillStyle,t.nodeBorderStyle,t.nodeBorderWidth)},v.resetNodes=function(){this.activeNodeList=[],this.initNodes()},v.update=function(t){var n=this.options,c=this.radius,d=this.context,r=this.nodeList,a=this.activeNodeList;this.initNodes();for(var h=0;h<r.length;h++)o(t,r[h],c)&&!s(a,r[h])&&a.push(r[h]);for(h=0;h<a.length;h++)i(d,a[h].x,a[h].y,c,n.activeNodeFillStyle,n.activeNodeBorderStyle,n.nodeBorderWidth);e(d,a.concat(t),n.lineStyle,n.lineWidth)},v.initStatus=function(){f.click()},v.switchStatusToSet=function(){this.passwdList.length=0,h(u)},v.switchStatusToCheck=function(t){this.passwdList=[t,t],h(f)}}(this);var options={};new Lock(options);